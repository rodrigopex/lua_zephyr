sample:
  name: Producer consumer
tests:
  sample.lua_zephyr.producer_consumer:
    harness: console
    extra_configs:
      - platform:mps2/an385:CONFIG_QEMU_ICOUNT=y
      - platform:qemu_x86:CONFIG_QEMU_ICOUNT=y
      - CONFIG_SHELL=n
    harness_config:
      type: multi_line
      ordered: true
      regex:
        - "System version: v\\d+\\.\\d+\\.\\d+_\\w+"
        - "Sensor_config=\\{sensor_id=42 offset=\\{x=1, y=2, z=3\\}\\}"
        - "<-- Lua producing data"
        - "\\s*1 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 1"
        - "\\s*2 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 2"
        - "\\s*3 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 3"
        - "\\s*4 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 4"
        - "\\s*5 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 5"
        - "\\s*6 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 6"
        - "\\s*7 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 7"
        - "\\s*8 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 8"
        - "\\s*9 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 9"
        - "\\s*10 - Accelerometer data x=\\d\\d,y=\\d\\d,z=\\d\\d"
        - "--> Lua received ack 10"
    tags: lua_zephyr
    integration_platforms:
      - qemu_x86
      - mps2/an385
